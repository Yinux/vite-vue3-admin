var B=Object.defineProperty,K=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var F=(n,o,t)=>o in n?B(n,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[o]=t,b=(n,o)=>{for(var t in o||(o={}))E.call(o,t)&&F(n,t,o[t]);if(w)for(var t of w(o))M.call(o,t)&&F(n,t,o[t]);return n},g=(n,o)=>K(n,T(o));var I=(n,o,t)=>new Promise((y,d)=>{var m=e=>{try{i(t.next(e))}catch(a){d(a)}},x=e=>{try{i(t.throw(e))}catch(a){d(a)}},i=e=>e.done?y(e.value):Promise.resolve(e.value).then(m,x);i((t=t.apply(n,o)).next())});import{b as v,e as S,f as R,a as A,h as q,i as $}from"./index.b371631f.js";import{g as V}from"./index.ff1ee39f.js";import{u as L}from"./dynamic-table.1a17b6c9.js";import{d as N,U as W,I as z,J,c as _,a3 as D,W as P,a4 as U}from"./index.44725425.js";import{u as j}from"./useFormModal.29273de1.js";import{b as G,a as H}from"./utils.1ab06744.js";import"./pick.b8be7556.js";import"./index.948778ba.js";import"./css.82a45a0b.js";import"./schema-form.309c9adc.js";import"./index.5aa97db4.js";import"./index.93fa4281.js";import"./zh_CN.4c83cac5.js";const O=[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"\u540D\u79F0",width:200,align:"center",dataIndex:"name"},{title:"\u6807\u8BC6",width:80,align:"center",dataIndex:"label"},{title:"\u5907\u6CE8",dataIndex:"remark",align:"center"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"\u66F4\u65B0\u65F6\u95F4",align:"center",dataIndex:"updatedAt",hideInSearch:!0}],Q=[{field:"name",component:"Input",label:"\u540D\u79F0",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"\u6807\u8BC6",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"\u5907\u6CE8"},{field:"menus",component:"Tree",label:"\u83DC\u5355\u6743\u9650",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"\u90E8\u95E8\u6743\u9650",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}],X=U(" \u65B0\u589E "),Y={name:"SystemPermissionRole"},me=N(g(b({},Y),{setup(n){const[o,t]=L(),[y]=j(),d=(e,a,r=[])=>a.reduce((p,l)=>{var c;return(c=l.children)!=null&&c.length?d(e,l.children,r):e.includes(l.value)&&p.push(l.value),p},r),m=e=>I(this,null,function*(){const[a]=yield y({modalProps:{title:`${e.id?"\u7F16\u8F91":"\u65B0\u589E"}\u89D2\u8272`,width:"50%",onFinish:s=>I(this,null,function*(){var k,C;e.id&&(s.roleId=e.id);const h=(k=a==null?void 0:a.compRefs)==null?void 0:k.menus,f=(C=a==null?void 0:a.compRefs)==null?void 0:C.depts,u=g(b({},s),{menus:[...h.halfCheckedKeys,...h.checkedKeys],depts:[...f.halfCheckedKeys,...f.checkedKeys]});yield(e.id?S:R)(u),t==null||t.reload()})},formProps:{labelWidth:100,schemas:Q}}),[r,p]=yield Promise.all([A(),V()]),l=G(p),c=H(r);if(a==null||a.updateSchema([{field:"menus",componentProps:{treeData:l}},{field:"depts",componentProps:{treeData:c}}]),e.id){const s=yield q({roleId:e.id}),h=s.menus.map(u=>u.menuId),f=s.depts.map(u=>u.departmentId);a==null||a.setFieldsValue(g(b({},e),{name:s.roleInfo.name,label:s.roleInfo.label,remark:s.roleInfo.remark,menus:d(h,l),depts:d(f,c)}))}}),x=e=>I(this,null,function*(){yield $({roleIds:[e.id]}),t==null||t.reload()}),i=[...O,{title:"\u64CD\u4F5C",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"\u7F16\u8F91",auth:{perm:"sys.role.update",effect:"disable"},onClick:()=>m(e)},{label:"\u5220\u9664",auth:"sys.role.delete",popConfirm:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",onConfirm:()=>x(e)}}]}];return(e,a)=>{const r=W("a-button");return z(),J("div",null,[_(P(o),{"row-key":"id","header-title":"\u89D2\u8272\u7BA1\u7406","data-request":P(v),columns:i,bordered:"",size:"small"},{toolbar:D(()=>[_(r,{type:"primary",disabled:!e.$auth("sys.role.add"),onClick:a[0]||(a[0]=p=>m({}))},{default:D(()=>[X]),_:1},8,["disabled"])]),_:1},8,["data-request"])])}}}));export{me as default};
